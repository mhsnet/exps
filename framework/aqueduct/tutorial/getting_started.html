<!DOCTYPE html>
<html>
<head>
<title>getting_started.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: "Segoe WPC", "Segoe UI", "SFUIText-Light", "HelveticaNeue-Light", sans-serif, "Droid Sans Fallback";
	font-size: 14px;
	padding: 0 12px;
	line-height: 22px;
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}


body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	color: #4080D0;
	text-decoration: none;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

h1 code,
h2 code,
h3 code,
h4 code,
h5 code,
h6 code {
	font-size: inherit;
	line-height: auto;
}

a:hover {
	color: #4080D0;
	text-decoration: underline;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left: 5px solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 14px;
	line-height: 19px;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

.mac code {
	font-size: 12px;
	line-height: 18px;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

/** Theming */

.vscode-light,
.vscode-light pre code {
	color: rgb(30, 30, 30);
}

.vscode-dark,
.vscode-dark pre code {
	color: #DDD;
}

.vscode-high-contrast,
.vscode-high-contrast pre code {
	color: white;
}

.vscode-light code {
	color: #A31515;
}

.vscode-dark code {
	color: #D7BA7D;
}

.vscode-light pre:not(.hljs),
.vscode-light code > div {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre:not(.hljs),
.vscode-dark code > div {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre:not(.hljs),
.vscode-high-contrast code > div {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

.vscode-light blockquote,
.vscode-dark blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.vscode-high-contrast blockquote {
	background: transparent;
	border-color: #fff;
}
</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family:  "Meiryo", "Segoe WPC", "Segoe UI", "SFUIText-Light", "HelveticaNeue-Light", sans-serif, "Droid Sans Fallback";
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

</head>
<body>
<h1 id="%E5%BC%80%E5%A7%8B-home-aqueduct-mhs2019221">开始 <a href="https://mhsnet.github.io/mhsstudynotes/" title="《MHS技术栈学习笔记》">Home</a> <a href="https://mhsnet.github.io/mhsstudynotes/framework/aqueduct/index.html" title="《Aqueduct》">Aqueduct</a> (mhs2019.2.21)</h1>
<ul>
<li><a href="https://mhsnet.github.io/mhsstudynotes/framework/aqueduct/tutorial/getting_started.html#installation" title="安装(Installation)">安装</a></li>
<li><a href="https://mhsnet.github.io/mhsstudynotes/framework/aqueduct/tutorial/getting_started.html#creating-project" title="创建项目(Creating a Project)">创建项目</a></li>
<li><a href="https://mhsnet.github.io/mhsstudynotes/framework/aqueduct/tutorial/getting_started.html#linking-controllers" title="链接控制器(Linking Controllers)">链接控制器</a></li>
<li><a href="https://mhsnet.github.io/mhsstudynotes/framework/aqueduct/tutorial/getting_started.html#advanced-routing" title="高级路由(Advanced Routing)">高级路由</a></li>
<li><a href="https://mhsnet.github.io/mhsstudynotes/framework/aqueduct/tutorial/getting_started.html#resource-controllers" title="资源控制器(ResourceControllers)">资源控制器</a></li>
<li><a href="https://mhsnet.github.io/mhsstudynotes/framework/aqueduct/tutorial/getting_started.html#multi-threading-and-application-state" title="多线程和应用程序状态(Multi-threading and Application State)">多线程和应用程序状态</a></li>
</ul>
<h2 id="span-idinstallation%E5%AE%89%E8%A3%85span-top"><span id="installation">安装</span> <a href="https://mhsnet.github.io/mhsstudynotes/framework/aqueduct/tutorial/getting_started.html" title="开始">Top</a></h2>
<pre class="hljs"><code><div>$ pub global activate aqueduct --- 安装Aqueduct命令行工具
</div></code></pre>
<h2 id="span-idcreating-project%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AEspan-top"><span id="creating-project">创建项目</span> <a href="https://mhsnet.github.io/mhsstudynotes/framework/aqueduct/tutorial/getting_started.html" title="开始">Top</a></h2>
<pre class="hljs"><code><div>$ aqueduct create dart_study_server --- 创建Aqueduct项目
$ aqueduct serve --- 启动项目
</div></code></pre>
<h2 id="span-idlinking-controllers%E9%93%BE%E6%8E%A5%E6%8E%A7%E5%88%B6%E5%99%A8linking-controllersspan-top"><span id="linking-controllers">链接控制器(Linking Controllers)</span> <a href="https://mhsnet.github.io/mhsstudynotes/framework/aqueduct/tutorial/getting_started.html" title="开始">Top</a></h2>
<pre class="hljs"><code><div>@override
Controller get entryPoint {
  final router = Router();
  
  router
    .route('/users')
    .link(() =&gt; APIKeyValidator())
    .link(() =&gt; Authorizer.bearer())
    .link(() =&gt; UsersController());

  router
    .route('/posts')
    .link(() =&gt; APIKeyValidator())
    .link(() =&gt; PostsController());

  return router;
}
</div></code></pre>
<blockquote>
<p>控制器处理请求(request)，可发送响应（response）或让链接控制器处理。默认router发送404，添加（a route）到router，创建控制器可以链接到的新通道(channel)入口点(entry point)。</p>
</blockquote>
<blockquote>
<p>控制器分终点(Endpoint)和中间件(Middleware)：</p>
<ol>
<li>终点控制器(Endpoint controllers)：发送响应(response)，实现请求(request)寻求的行为。</li>
<li>中间件控制器(Middleware controllers)：可创建任何中间件，在到达终端控制器前处理请求(request)，提供你喜欢的行为。例（Router：将请求定向到正确的控制器；Authorizer：验证请求的授权）。</li>
</ol>
</blockquote>
<blockquote>
<p>通道可有0或多个中间件控制器，以终点控制器结束。大多控制器只能有一个链接控制器，但路由可有多个。</p>
</blockquote>
<h2 id="span-idadvanced-routing%E9%AB%98%E7%BA%A7%E8%B7%AF%E7%94%B1advanced-routingspan-top"><span id="advanced-routing">高级路由(Advanced Routing)</span> <a href="https://mhsnet.github.io/mhsstudynotes/framework/aqueduct/tutorial/getting_started.html" title="开始">Top</a></h2>
<blockquote>
<ol>
<li>/:xxx --- 路径变量</li>
<li>/[:xxx] --- 路径变量可选</li>
</ol>
</blockquote>
<pre class="hljs"><code><div>router
  .route('/users/[:id]')
  .link(() =&gt; UsersController());
</div></code></pre>
<h2 id="span-idresource-controllers%E8%B5%84%E6%BA%90%E6%8E%A7%E5%88%B6%E5%99%A8resourcecontrollersspan-top"><span id="resource-controllers">资源控制器(ResourceControllers)</span> <a href="https://mhsnet.github.io/mhsstudynotes/framework/aqueduct/tutorial/getting_started.html" title="开始">Top</a></h2>
<blockquote>
<p>例（lib/controller/users_controller.dart）：</p>
</blockquote>
<pre class="hljs"><code><div>import 'package:aqueduct/aqueduct.dart';
import 'package:dart_study_server/dart_study_server.dart';

class UsersController extends ResourceController {
  final _users = [
    {'id': 1, 'name': '用户1'},
    {'id': 2, 'name': '用户2'},
    {'id': 3, 'name': '用户3'}
  ];

  @Operation.get()
  Future&lt;Response&gt; getAllUsers() async {
    return Response.ok(_users);
  }

  @Operation.get('id')
  Future&lt;Response&gt; getUserByID(@Bind.path('id') int id) async {
    final user =
        _users.firstWhere((user) =&gt; user['id'] == id, orElse: () =&gt; null);
    if (user == null) {
      return Response.notFound();
    }
    return Response.ok(user);
  }
}
</div></code></pre>
<blockquote>
<p>资源控制器(ResourceController)：每个方法都有一个操作注释(Operation annotation)，用于标识请求必须触发的HTTP方法和路径变量。</p>
</blockquote>
<blockquote>
<p>可以绑定路径变量(path variables)、头(headers)、查询参数(query parameters)和主体(bodies)。绑定路径变量时，我们必须用参数指定哪个路径变量为@Bind.path(pathvariablename)</p>
</blockquote>
<h2 id="span-idmulti-threading-and-application-state%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%92%8C%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%8A%B6%E6%80%81multi-threading-and-application-statespan-top"><span id="multi-threading-and-application-state">多线程和应用程序状态(Multi-threading and Application State)</span> <a href="https://mhsnet.github.io/mhsstudynotes/framework/aqueduct/tutorial/getting_started.html" title="开始">Top</a></h2>
<blockquote>
<ol>
<li>将数据存数据库，使程序重启时不丢失。</li>
<li>伴随部署容器化，无状态Web服务成为一种需求，Aqueduct多线程使检查违反此规则更容易。</li>
<li>Aqueduct运行时创建多线程，每个线程拥有独立isolated，数据不能访问其它线程。</li>
<li>每个isolated创建通道实例，每个请求只提供1个isolated，负载均衡器后多个服务运行行为相同，并且速度更快。</li>
<li>应用程序中存储数据，更改数据只会在某个isolated中更改，再次请求不太可能看到更改—另一个具有不同数据的isolated可能处理该请求。</li>
</ol>
</blockquote>
<h2 id=""></h2>

</body>
</html>
